<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MBS Overview â€¢ Asianloop</title>

  <!-- Existing site CSS -->
  <link rel="stylesheet" href="/public/css/mbsdashboard.css" />

  <!-- Light mode defaults + optional dark toggle (non-destructive overrides) -->
  <style>
    /* Default to LIGHT: apply on :root (and when data-theme="light") */
    :root, html[data-theme="light"] {
      color-scheme: light;
      --bg: #ffffff;
      --ink: #0f172a;
      --muted: #64748b;
      --card: #ffffff;
      --border: #e5e7eb;
      --chip: #f1f5f9;
      --accent: #2563eb;
    }

    /* Optional DARK palette (only when toggled) */
    html[data-theme="dark"] {
      color-scheme: dark;
      --bg: #0b1220;
      --ink: #e5edf5;
      --muted: #93a3b8;
      --card: #0f172a;
      --border: #1f2937;
      --chip: #111827;
      --accent: #60a5fa;
    }

    /* High-specificity light/dark application without touching your base CSS */
    body { background: var(--bg); color: var(--ink); }
    .al-header, .al-footer { background: var(--card); border-bottom: 1px solid var(--border); }
    .al-footer { border-top: 1px solid var(--border); border-bottom: none; }
    .al-sidemenu { background: var(--card); border-right: 1px solid var(--border); }
    .al-sidemenu .item { color: var(--ink); }
    .al-sidemenu .item.active { background: rgba(37,99,235,0.08); }
    .al-main h1, .al-main h2 { color: var(--ink); }
    .card { background: var(--card); border: 1px solid var(--border); }
    .table { background: var(--card); border: 1px solid var(--border); }
    .table th, .table td { border-top: 1px solid var(--border); color: var(--ink); }
    .placeholder { color: var(--muted); }
    .link-grid .link { color: var(--accent); }
    .badge { background: var(--chip); color: var(--ink); border: 1px solid var(--border); }

    /* Small niceties */
    .al-topnav .mode-toggle {
      display: inline-flex; align-items: center; gap: 8px;
      font: inherit; padding: 6px 10px; border: 1px solid var(--border);
      background: var(--card); color: var(--ink); border-radius: 8px; cursor: pointer;
    }
  </style>
</head>
<body data-init="light">



<header class="al-header">
<div class="al-inner">
  <link rel="stylesheet" href="/public/css/mbsdashboard.css" />

<a class="al-brand" href="/">Asianloop Staff Portal</a>
<nav class="al-topnav">
  <span id="welcomeUser">Welcome, {{userEmail}}</span>
  <button id="themeToggle" class="mode-toggle" type="button" title="Toggle theme">
    <span aria-hidden="true">ðŸŒ“</span> <span id="themeLabel">Dark mode</span>
  </button>
  <a href="/logout" class="btn btn-ghost">Logout</a>
</nav>

</div>
</header>

<div class="al-shell">
<!-- Side Menu -->
<aside class="al-sidemenu">
<div class="al-sidemenu-title">Market & Business Strategy</div>
<a class="item active" href="/msbs">Overview</a>
<a class="item" href="/msbs/metrics">Metrics</a>
<a class="item" href="/msbs/events">Events</a>
<a class="item" href="/msbs/branding">Branding</a>
<div class="divider"></div>
<div class="group-label">MBS Workspace</div>
<a class="item" href="/msbs/internal">Team Home</a>
</aside>

<!-- Main Content -->
<main class="al-main">
<h1>MBS Overview</h1>

<section class="card">
<h2>Announcements</h2>
<!-- MONGO: msbs_announcements (public). Show pinned first, then latest 10. -->
<ul id="announcementsList">
<li class="placeholder">(Announcements will appear here.)</li>
</ul>


  <table class="table" id="overviewEventsMini">
  <thead><tr><th>Name</th><th>Dates</th><th>Location</th><th>Link</th></tr></thead>
  <tbody><tr><td colspan="4" class="placeholder">(Upcoming events appear here.)</td></tr></tbody>
</table>

</section>

<section class="card">
<h2>Quick Links</h2>
<!-- MONGO: msbs_brand_assets (public) â€” GridFS links (logo, brochure, letterhead, slides) -->
<ul class="link-grid">
<li><a href="#" class="link">Logo â€” PNG (Light)</a></li>
<li><a href="#" class="link">Logo â€” PNG (Dark)</a></li>
<li><a href="#" class="link">Favicon â€” ICO</a></li>
<li><a href="#" class="link">Company Brochure â€” PDF</a></li>
<li><a href="#" class="link">Letterhead â€” DOCX</a></li>
<li><a href="#" class="link">Slide Master â€” PPTX</a></li>
</ul>
</section>
</main>
</div>

<footer class="al-footer">Â© Asianloop â€¢ MBS</footer>

<script>
  // Theme boot: default to LIGHT, respect saved preference
  (function() {
    var saved = localStorage.getItem('al_theme');
    var html = document.documentElement;
    if (saved === 'dark') html.setAttribute('data-theme', 'dark');
    else html.setAttribute('data-theme', 'light');

    // Update button label if already present
    var label = document.getElementById('themeLabel');
    if (label) label.textContent = (html.getAttribute('data-theme') === 'dark') ? 'Light mode' : 'Dark mode';
  })();

  // Wire up the toggle button
  (function () {
    var btn = document.getElementById('themeToggle');
    if (!btn) return;
    btn.addEventListener('click', function () {
      var html = document.documentElement;
      var now = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', now);
      localStorage.setItem('al_theme', now);
      var label = document.getElementById('themeLabel');
      if (label) label.textContent = (now === 'dark') ? 'Light mode' : 'Dark mode';
    });
  })();
</script>

  
<script>
// Fill "Welcome, ..." like testdash
(function () {
  var slot = document.getElementById('welcomeUser');
  function readCookie(name) {
    var cookies = (document.cookie || '').split('; ');
    for (var i = 0; i < cookies.length; i++) {
      var p = cookies[i], eq = p.indexOf('=');
      if (eq > -1 && decodeURIComponent(p.slice(0,eq)) === name) return decodeURIComponent(p.slice(eq+1));
    }
    return null;
  }
  var email = readCookie('al_user_email');
  if (slot && email) slot.textContent = email;
})();

// Render announcements
(async function(){
  const ul = document.getElementById('announcementsList');
  if (!ul) return;
  try {
    const r = await fetch('/api/msbs/announcements', { cache:'no-store' });
    const items = r.ok ? await r.json() : [];
    if (!items.length) return;

    ul.innerHTML = '';
    items.forEach(a => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
          <div>
            <strong>${a.title || 'Untitled'}</strong>
            <div class="hint">${a.authorEmail ? a.authorEmail + ' â€¢ ' : ''}${a.createdAt ? new Date(a.createdAt).toLocaleDateString() : ''}</div>
          </div>
          ${a.pinned ? '<span class="badge">Pinned</span>' : ''}
        </div>
        <div style="margin-top:6px">${a.body || ''}</div>
      `;
      li.className = 'ann'; // uses your card-ish list style
      ul.appendChild(li);
    });
  } catch (_) {}
})();

// Render brand assets
(async function(){
  const ul = document.getElementById('brandAssetList');
  if (!ul) return;
  try {
    const r = await fetch('/api/msbs/brand-assets', { cache:'no-store' });
    const items = r.ok ? await r.json() : [];
    if (!items.length) return;

    ul.innerHTML = '';
    items.forEach(a => {
      const li = document.createElement('li');
      li.innerHTML = `<a class="link" href="${a.href}" target="_blank" rel="noopener">${a.title || 'Download'}</a>`;
      ul.appendChild(li);
    });
  } catch (_) {}
})();


// Optional: show upcoming events on Overview (under any placeholder you like)
(async function(){
  const table = document.getElementById('overviewEventsMini');
  if (!table) return;

  try {
    const r = await fetch('/api/msbs/events', { cache: 'no-store' });
    if (!r.ok) throw 0;
    const data = await r.json();
    const items = data.items || [];


    const tbody = table.querySelector('tbody');
    if (!tbody || !items.length) return;

    tbody.innerHTML = '';
    items.forEach(ev => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ev.name}</td>
        <td>${ev.dates}</td>
        <td>${ev.location}</td>
        <td><a href="${ev.url}" target="_blank" rel="noopener">Open</a></td>
      `;
      tbody.appendChild(tr);
    });
  } catch(_){}
})();
  
</script>


</body>
</html>
