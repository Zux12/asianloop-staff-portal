<!DOCTYPE html>
<header class="al-header">
<div class="al-inner">
  <link rel="stylesheet" href="/public/css/mbsdashboard.css" />

<a class="al-brand" href="/">Asianloop Staff Portal</a>
<nav class="al-topnav">
<span id="welcomeUser">Welcome, {{userEmail}}</span>
<a href="/logout" class="btn btn-ghost">Logout</a>
</nav>
</div>
</header>

<div class="al-shell">
<!-- Side Menu -->
<aside class="al-sidemenu">
<div class="al-sidemenu-title">Market & Business Strategy</div>
<a class="item active" href="/msbs">Overview</a>
<a class="item" href="/msbs/metrics">Metrics</a>
<a class="item" href="/msbs/events">Events</a>
<a class="item" href="/msbs/branding">Branding</a>
<div class="divider"></div>
<div class="group-label">MBS Workspace</div>
<a class="item" href="/msbs/internal">Team Home</a>
</aside>

<!-- Main Content -->
<main class="al-main">
<h1>MBS Overview</h1>

<section class="card">
<h2>Announcements</h2>
<!-- MONGO: msbs_announcements (public). Show pinned first, then latest 10. -->
<ul id="announcementsList">
<li class="placeholder">(Announcements will appear here.)</li>
</ul>


  <table class="table" id="overviewEventsMini">
  <thead><tr><th>Name</th><th>Dates</th><th>Location</th><th>Link</th></tr></thead>
  <tbody><tr><td colspan="4" class="placeholder">(Top 3 upcoming events appear here.)</td></tr></tbody>
</table>

</section>

<section class="card">
<h2>Quick Links</h2>
<!-- MONGO: msbs_brand_assets (public) — GridFS links (logo, brochure, letterhead, slides) -->
<ul class="link-grid">
<li><a href="#" class="link">Logo — PNG (Light)</a></li>
<li><a href="#" class="link">Logo — PNG (Dark)</a></li>
<li><a href="#" class="link">Favicon — ICO</a></li>
<li><a href="#" class="link">Company Brochure — PDF</a></li>
<li><a href="#" class="link">Letterhead — DOCX</a></li>
<li><a href="#" class="link">Slide Master — PPTX</a></li>
</ul>
</section>
</main>
</div>

<footer class="al-footer">© Asianloop • MBS</footer>

<script>
// Fill "Welcome, ..." like testdash
(function () {
  var slot = document.getElementById('welcomeUser');
  function readCookie(name) {
    var cookies = (document.cookie || '').split('; ');
    for (var i = 0; i < cookies.length; i++) {
      var p = cookies[i], eq = p.indexOf('=');
      if (eq > -1 && decodeURIComponent(p.slice(0,eq)) === name) return decodeURIComponent(p.slice(eq+1));
    }
    return null;
  }
  var email = readCookie('al_user_email');
  if (slot && email) slot.textContent = email;
})();

// Render announcements
(async function(){
  const ul = document.getElementById('announcementsList');
  if (!ul) return;
  try {
    const r = await fetch('/api/msbs/announcements', { cache:'no-store' });
    const items = r.ok ? await r.json() : [];
    if (!items.length) return;

    ul.innerHTML = '';
    items.forEach(a => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
          <div>
            <strong>${a.title || 'Untitled'}</strong>
            <div class="hint">${a.authorEmail ? a.authorEmail + ' • ' : ''}${a.createdAt ? new Date(a.createdAt).toLocaleDateString() : ''}</div>
          </div>
          ${a.pinned ? '<span class="badge">Pinned</span>' : ''}
        </div>
        <div style="margin-top:6px">${a.body || ''}</div>
      `;
      li.className = 'ann'; // uses your card-ish list style
      ul.appendChild(li);
    });
  } catch (_) {}
})();

// Render brand assets
(async function(){
  const ul = document.getElementById('brandAssetList');
  if (!ul) return;
  try {
    const r = await fetch('/api/msbs/brand-assets', { cache:'no-store' });
    const items = r.ok ? await r.json() : [];
    if (!items.length) return;

    ul.innerHTML = '';
    items.forEach(a => {
      const li = document.createElement('li');
      li.innerHTML = `<a class="link" href="${a.href}" target="_blank" rel="noopener">${a.title || 'Download'}</a>`;
      ul.appendChild(li);
    });
  } catch (_) {}
})();


// Optional: show top 3 upcoming events on Overview (under any placeholder you like)
(async function(){
  const table = document.getElementById('overviewEventsMini');
  if (!table) return;

  try {
    const r = await fetch('/api/msbs/events', { cache: 'no-store' });
    if (!r.ok) throw 0;
    const data = await r.json();
    const items = (data.items || []).slice(0, 3);

    const tbody = table.querySelector('tbody');
    if (!tbody || !items.length) return;

    tbody.innerHTML = '';
    items.forEach(ev => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ev.name}</td>
        <td>${ev.dates}</td>
        <td>${ev.location}</td>
        <td><a href="${ev.url}" target="_blank" rel="noopener">Open</a></td>
      `;
      tbody.appendChild(tr);
    });
  } catch(_){}
})();
  
</script>


</body>
</html>
