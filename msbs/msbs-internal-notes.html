<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MBS — Team Notes</title>
<link rel="icon" href="/favicon.ico" />
<link rel="stylesheet" href="/public/css/mbsdashboard.css" />

</head>
<body data-page="internal-notes">
<header class="al-header">
<div class="al-inner">
<a class="al-brand" href="/">Asianloop Staff Portal</a>
<nav class="al-topnav">
<span id="welcomeUser">Welcome, {{userEmail}}</span>
<a href="/logout" class="btn btn-ghost">Logout</a>
</nav>
</div>
</header>

<div class="al-shell">
<aside class="al-sidemenu">
<div class="al-sidemenu-title">MBS Workspace</div>
<a class="item" href="/msbs/internal">Team Home</a>
<a class="item" href="/msbs/internal/social">Social</a>
<a class="item" href="/msbs/internal/conferences">Conferences</a>
<a class="item" href="/msbs/internal/strategy">Strategy</a>
<a class="item" href="/msbs/internal/files">Files</a>
<a class="item active" href="/msbs/internal/notes">Team Notes</a>
<div class="divider"></div>
<a class="item" href="/msbs">Back to Public</a>
</aside>

<main class="al-main">
<h1>Team Notes & Reminders</h1>

<section class="card">
<h2>Notes</h2>
<!-- MONGO: simple notes collection or reuse msbs_announcements with internal flag -->
<ul id="notesList"><li class="placeholder">(Notes go here.)</li></ul>
</section>

<section class="card">
<h2>Deadlines</h2>
<table class="table" id="deadlinesTbl">
<thead><tr><th>Item</th><th>Due</th><th>Owner</th><th>Status</th></tr></thead>
<tbody><tr><td colspan="4" class="placeholder">(Deadlines go here.)</td></tr></tbody>
</table>
</section>
</main>
</div>

<footer class="al-footer">© Asianloop • MBS</footer>

  <script>
// Fill welcome
(function(){
  var slot = document.getElementById('welcomeUser');
  function readCookie(n){return (document.cookie||'').split('; ').map(p=>p.split('=')).find(p=>p[0]==n)?.[1]||null;}
  var email = decodeURIComponent(readCookie('al_user_email')||'');
  if (slot && email) slot.textContent=email;
})();

// Load notes
(async function(){
  const ul = document.getElementById('notesList');
  const tbl = document.getElementById('deadlinesTbl').querySelector('tbody');
  try{
    const r = await fetch('/api/msbs/notes',{cache:'no-store'});
    if(!r.ok) throw 0;
    const items = await r.json();
    ul.innerHTML=''; tbl.innerHTML='';
    items.forEach(n=>{
      const li=document.createElement('li');
      li.textContent=`${n.title} — ${n.status}`;
      ul.appendChild(li);

      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${n.title}</td>
        <td>${n.due? new Date(n.due).toLocaleDateString():''}</td>
        <td>${n.ownerEmail||''}</td>
        <td>${n.status}</td>`;
      tbl.appendChild(tr);
    });
  }catch(_){}
})();

// Quick add note
async function addNote(){
  const t=prompt('Note title?'); if(!t) return;
  const d=prompt('Due date? (YYYY-MM-DD)');
  await fetch('/api/msbs/notes/upsert',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title:t,due:d})});
  location.reload();
}
</script>

</body>
</html>
