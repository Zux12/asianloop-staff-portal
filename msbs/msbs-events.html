<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MBS â€” Events</title>
<link rel="icon" href="/favicon.ico" />

  <link rel="stylesheet" href="/public/css/mbsdashboard.css" />


<style>
  :root, html[data-theme="light"]{
    color-scheme: light;
    --bg:#ffffff; --ink:#111111; --muted:#334155;
    --card:#ffffff; --border:#e5e7eb; --chip:#f1f5f9; --accent:#2563eb;
  }
  html[data-theme="dark"]{
    color-scheme: dark;
    --bg:#0b1220; --ink:#e5edf5; --muted:#93a3b8;
    --card:#0f172a; --border:#1f2937; --chip:#111827; --accent:#60a5fa;
  }
  body{background:var(--bg);color:var(--ink);}
  .al-header,.al-footer{background:var(--card);border-bottom:1px solid var(--border);}
  .al-footer{border-top:1px solid var(--border);border-bottom:none;}
  .al-sidemenu{background:var(--card);border-right:1px solid var(--border);}
  .al-sidemenu .item{color:var(--ink);}
  .al-sidemenu .item.active{background:rgba(37,99,235,.08);}
  .card,.table{background:var(--card);border:1px solid var(--border);}
  .table th,.table td{border-top:1px solid var(--border);color:var(--ink);}
  .link{color:var(--accent);}
  .badge{background:var(--chip);color:var(--ink);border:1px solid var(--border);}
  .placeholder{color:var(--muted);}
  .al-topnav .mode-toggle{
    display:inline-flex;align-items:center;gap:8px;
    font:inherit;padding:6px 10px;border:1px solid var(--border);
    background:var(--card);color:var(--ink);border-radius:8px;cursor:pointer;
  }
</style>
<style id="contrast-patch">
  html[data-theme="light"], :root { --ink:#111111; --muted:#334155; }
  body,.al-main,.al-header,.al-sidemenu,.al-footer,
  .card,.table,h1,h2,h3,h4,h5,h6,p,li,dt,dd,small,span,label,legend{color:var(--ink);}
  html[data-theme="light"] a{color:#0b5dd7;} html[data-theme="light"] a:hover{color:#083a9b;}
  .table th{color:#111111;font-weight:600;}
  .muted,[class*="muted"]{color:var(--muted)!important;}
  .btn,.btn-ghost{color:var(--ink);} .btn-primary{background:var(--accent);color:#fff;}
  input,textarea,select{color:var(--ink);background:var(--card);} ::placeholder{color:#64748b;opacity:1;}
</style>
<style id="sidemenu-ink">
  html[data-theme="light"] .al-sidemenu .item:not(:hover):not(.active),
  html[data-theme="light"] .al-sidemenu a.item:not(:hover):not(.active),
  html[data-theme="light"] .al-sidemenu .item:not(:hover):not(.active) .label{color:#111111!important;}
  html[data-theme="light"] .al-sidemenu .item:not(:hover):not(.active) svg{stroke:#111111!important;fill:none;}
</style>
  
</head>
<body data-page="events">
<header class="al-header">
<div class="al-inner">
<a class="al-brand" href="/">Asianloop Staff Portal</a>
<nav class="al-topnav">
  <span id="welcomeUser">Welcome, {{userEmail}}</span>
  <button id="themeToggle" class="mode-toggle" type="button" title="Toggle theme">
    <span aria-hidden="true">ðŸŒ“</span> <span id="themeLabel">Dark mode</span>
  </button>
  <a href="/logout" class="btn btn-ghost">Logout</a>
</nav>

</div>
</header>

<div class="al-shell">
<aside class="al-sidemenu">
<div class="al-sidemenu-title">Market & Business Strategy</div>
<a class="item" href="/msbs">Overview</a>
<a class="item" href="/msbs/metrics">Metrics</a>
<a class="item active" href="/msbs/events">Events</a>
<a class="item" href="/msbs/branding">Branding</a>
<div class="divider"></div>
<div class="group-label">MBS Workspace</div>
<a class="item" href="/msbs/internal">Team Home</a>
</aside>

<main class="al-main">
<h1>Upcoming Oil & Gas Events</h1>

<section class="card">
  <div class="toolbar">
    <span class="hint">
      Auto-populated weekly from sources. Last refresh: 
      <span id="eventsRefreshedAt">â€”</span>
    </span>
  </div>
  <table class="table" id="eventsTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Dates</th>
        <th>Location</th>
        <th>Status</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="5" class="placeholder">(Events will appear here.)</td>
      </tr>
    </tbody>
  </table>
</section>


<section class="card info">
<p>MBS team can set status in the internal Conferences page.</p>
</section>
</main>
</div>

<footer class="al-footer">Â© Asianloop â€¢ MBS</footer>

  <script>
  (function(){
    var saved=localStorage.getItem('al_theme');
    var html=document.documentElement;
    html.setAttribute('data-theme', saved==='dark'?'dark':'light');
    var label=document.getElementById('themeLabel');
    if(label) label.textContent=(html.getAttribute('data-theme')==='dark')?'Light mode':'Dark mode';
  })();
  (function(){
    var btn=document.getElementById('themeToggle'); if(!btn) return;
    btn.addEventListener('click',function(){
      var html=document.documentElement;
      var now=html.getAttribute('data-theme')==='dark'?'light':'dark';
      html.setAttribute('data-theme',now);
      localStorage.setItem('al_theme',now);
      var label=document.getElementById('themeLabel');
      if(label) label.textContent=(now==='dark')?'Light mode':'Dark mode';
    });
  })();
</script>

<script>
// Fill "Welcome, ..." (same helper as overview)
(function () {
  var slot = document.getElementById('welcomeUser');
  function readCookie(name) {
    var cookies = (document.cookie || '').split('; ');
    for (var i = 0; i < cookies.length; i++) {
      var p = cookies[i], eq = p.indexOf('=');
      if (eq > -1 && decodeURIComponent(p.slice(0,eq)) === name) return decodeURIComponent(p.slice(eq+1));
    }
    return null;
  }
  var email = readCookie('al_user_email');
  if (slot && email) slot.textContent = email;
})();

// Render events table
(async function(){
  const stamp = document.getElementById('eventsRefreshedAt');
  const tbody = document.querySelector('#eventsTable tbody');
  if (!tbody) return;

  try {
    const r = await fetch('/api/msbs/events', { cache: 'no-store' });
    if (!r.ok) throw new Error('Load failed');
    const data = await r.json();

    if (stamp && data.refreshedAt) {
      const d = new Date(data.refreshedAt);
      stamp.textContent = d.toLocaleString();
    }

    const items = Array.isArray(data.items) ? data.items : [];
    if (!items.length) return;

    tbody.innerHTML = '';
    items.forEach(ev => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ev.name || ''}</td>
        <td>${ev.dates || ''}</td>
        <td>${ev.location || ''}</td>
        <td>${ev.status || ''}</td>
        <td>${ev.url ? `<a href="${ev.url}" target="_blank" rel="noopener">Open</a>` : ''}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    // Leave placeholder row in place if it fails silently
  }
})();
</script>

  
</body>
</html>
