<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MBS — Events</title>
<link rel="icon" href="/favicon.ico" />

  <link rel="stylesheet" href="/public/css/mbsdashboard.css" />

</head>
<body data-page="events">
<header class="al-header">
<div class="al-inner">
<a class="al-brand" href="/">Asianloop Staff Portal</a>
<nav class="al-topnav">
<span id="welcomeUser">Welcome, {{userEmail}}</span>
<a href="/logout" class="btn btn-ghost">Logout</a>
</nav>
</div>
</header>

<div class="al-shell">
<aside class="al-sidemenu">
<div class="al-sidemenu-title">Market & Business Strategy</div>
<a class="item" href="/msbs">Overview</a>
<a class="item" href="/msbs/metrics">Metrics</a>
<a class="item active" href="/msbs/events">Events</a>
<a class="item" href="/msbs/branding">Branding</a>
<div class="divider"></div>
<div class="group-label">MBS Workspace</div>
<a class="item" href="/msbs/internal">Team Home</a>
</aside>

<main class="al-main">
<h1>Upcoming Oil & Gas Events</h1>

<section class="card">
<div class="toolbar">
<span class="hint">Auto‑populated weekly from sources. Last refresh: <span id="eventsRefreshedAt">—</span></span>
</div>
<!-- MONGO: msbs_events (public). Columns: Name • Dates • City • Country • Status • Link -->
<table class="table" id="eventsTable">
<thead>
<tr><th>Name</th><th>Dates</th><th>Location</th><th>Status</th><th>Link</th></tr>
</thead>
<tbody>
<tr><td colspan="5" class="placeholder">(Events will appear here.)</td></tr>
</tbody>
</table>
</section>

<section class="card info">
<p>MBS team can set status in the internal Conferences page.</p>
</section>
</main>
</div>

<footer class="al-footer">© Asianloop • MBS</footer>

<script>
// Fill "Welcome, ..." (same helper as overview)
(function () {
  var slot = document.getElementById('welcomeUser');
  function readCookie(name) {
    var cookies = (document.cookie || '').split('; ');
    for (var i = 0; i < cookies.length; i++) {
      var p = cookies[i], eq = p.indexOf('=');
      if (eq > -1 && decodeURIComponent(p.slice(0,eq)) === name) return decodeURIComponent(p.slice(eq+1));
    }
    return null;
  }
  var email = readCookie('al_user_email');
  if (slot && email) slot.textContent = email;
})();

// Render events table
(async function(){
  const stamp = document.getElementById('eventsRefreshedAt');
  const tbody = document.querySelector('#eventsTable tbody');
  if (!tbody) return;

  try {
    const r = await fetch('/api/msbs/events', { cache: 'no-store' });
    if (!r.ok) throw new Error('Load failed');
    const data = await r.json();

    if (stamp && data.refreshedAt) {
      const d = new Date(data.refreshedAt);
      stamp.textContent = d.toLocaleString();
    }

    const items = Array.isArray(data.items) ? data.items : [];
    if (!items.length) return;

    tbody.innerHTML = '';
    items.forEach(ev => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ev.name || ''}</td>
        <td>${ev.dates || ''}</td>
        <td>${ev.location || ''}</td>
        <td>${ev.status || ''}</td>
        <td>${ev.url ? `<a href="${ev.url}" target="_blank" rel="noopener">Open</a>` : ''}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (err) {
    // Leave placeholder row in place if it fails silently
  }
})();
</script>

  
</body>
</html>
